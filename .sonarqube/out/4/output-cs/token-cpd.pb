Éú
{C:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_VillaAPI\Controllers\VillaAPIController.cs
	namespace

 	
MagicVilla_VillaAPI


 
.

 
Controllers

 )
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
VillaAPIController #
:$ %
ControllerBase& 4
{ 
private 
readonly 
IVillaRepository )
_repo* /
;/ 0
private 
readonly 
IMapper  
_mapper! (
;( )
	protected 
APIResponse 
	_response '
;' (
public 
VillaAPIController !
(! "
IVillaRepository" 2
repo3 7
,7 8
IMapper9 @
mapperA G
)G H
{ 	
_repo 
= 
repo 
; 
_mapper 
= 
mapper 
; 
this 
. 
	_response 
= 
new  
(  !
)! "
;" #
} 	
[ 	
HttpGet	 
] 
[ 	 
ProducesResponseType	 
( 
StatusCodes )
.) *
Status200OK* 5
)5 6
]6 7
public 
async 
Task 
< 
ActionResult &
<& '
APIResponse' 2
>2 3
>3 4
	GetVillas5 >
(> ?
)? @
{ 	
try!! 
{"" 
var## 
villa## 
=## 
await## !
_repo##" '
.##' (
GetAllAsync##( 3
(##3 4
)##4 5
;##5 6
	_response$$ 
.$$ 
Result$$  
=$$! "
_mapper$$# *
.$$* +
Map$$+ .
<$$. /
IEnumerable$$/ :
<$$: ;
VillaDto$$; C
>$$C D
>$$D E
($$E F
villa$$F K
)$$K L
;$$L M
	_response%% 
.%% 

StatusCode%% $
=%%% &
HttpStatusCode%%' 5
.%%5 6
OK%%6 8
;%%8 9
return&& 
Ok&& 
(&& 
	_response&& #
)&&# $
;&&$ %
}'' 
catch(( 
((( 
	Exception(( 
ex(( 
)((  
{)) 
	_response** 
.** 
	IsSuccess** #
=**$ %
false**& +
;**+ ,
	_response++ 
.++ 
ErrorMessages++ '
=,, 
new,, 
List,, 
<,, 
string,, %
>,,% &
(,,& '
),,' (
{,,) *
ex,,+ -
.,,- .
ToString,,. 6
(,,6 7
),,7 8
},,9 :
;,,: ;
}-- 
return.. 
	_response.. 
;.. 
}// 	
[00 	
HttpGet00	 
(00 
$str00 
,00 
Name00 !
=00" #
$str00$ .
)00. /
]00/ 0
[11 	 
ProducesResponseType11	 
(11 
StatusCodes11 )
.11) *
Status200OK11* 5
)115 6
]116 7
[22 	 
ProducesResponseType22	 
(22 
StatusCodes22 )
.22) *
Status400BadRequest22* =
)22= >
]22> ?
[33 	 
ProducesResponseType33	 
(33 
StatusCodes33 )
.33) *
Status404NotFound33* ;
)33; <
]33< =
public44 
async44 
Task44 
<44 
ActionResult44 &
<44& '
APIResponse44' 2
>442 3
>443 4
GetVilla445 =
(44= >
int44> A
id44B D
)44D E
{55 	
try66 
{77 
if88 
(88 
id88 
<=88 
$num88 
)88 
{99 
	_response;; 
.;; 

StatusCode;; (
=;;) *
HttpStatusCode;;+ 9
.;;9 :

BadRequest;;: D
;;;D E
return<< 

BadRequest<< %
(<<% &
	_response<<& /
)<</ 0
;<<0 1
}== 
var>> 
villa>> 
=>> 
await>> !
_repo>>" '
.>>' (
GetAsync>>( 0
(>>0 1
x>>1 2
=>>>3 5
x>>6 7
.>>7 8
Id>>8 :
==>>; =
id>>> @
)>>@ A
;>>A B
if?? 
(?? 
villa?? 
==?? 
null?? !
)??! "
{@@ 
	_responseAA 
.AA 

StatusCodeAA (
=AA) *
HttpStatusCodeAA+ 9
.AA9 :
NotFoundAA: B
;AAB C
returnBB 
NotFoundBB #
(BB# $
	_responseBB$ -
)BB- .
;BB. /
}CC 
	_responseDD 
.DD 
ResultDD  
=DD! "
_mapperDD# *
.DD* +
MapDD+ .
<DD. /
VillaDtoDD/ 7
>DD7 8
(DD8 9
villaDD9 >
)DD> ?
;DD? @
	_responseEE 
.EE 

StatusCodeEE $
=EE% &
HttpStatusCodeEE' 5
.EE5 6
OKEE6 8
;EE8 9
returnFF 
OkFF 
(FF 
	_responseFF #
)FF# $
;FF$ %
}GG 
catchHH 
(HH 
	ExceptionHH 
exHH 
)HH  
{II 
	_responseJJ 
.JJ 
	IsSuccessJJ #
=JJ$ %
falseJJ& +
;JJ+ ,
	_responseKK 
.KK 
ErrorMessagesKK '
=LL 
newLL 
ListLL 
<LL 
stringLL %
>LL% &
(LL& '
)LL' (
{LL) *
exLL+ -
.LL- .
ToStringLL. 6
(LL6 7
)LL7 8
}LL9 :
;LL: ;
}MM 
returnNN 
	_responseNN 
;NN 
}OO 	
[PP 	
HttpPostPP	 
]PP 
[QQ 	 
ProducesResponseTypeQQ	 
(QQ 
StatusCodesQQ )
.QQ) *
Status201CreatedQQ* :
)QQ: ;
]QQ; <
[RR 	 
ProducesResponseTypeRR	 
(RR 
StatusCodesRR )
.RR) *
Status400BadRequestRR* =
)RR= >
]RR> ?
[SS 	 
ProducesResponseTypeSS	 
(SS 
StatusCodesSS )
.SS) *(
Status500InternalServerErrorSS* F
)SSF G
]SSG H
publicTT 
asyncTT 
TaskTT 
<TT 
ActionResultTT &
<TT& '
APIResponseTT' 2
>TT2 3
>TT3 4
CreateTT5 ;
(TT; <
[TT< =
FromBodyTT= E
]TTE F
VillaCreateDtoTTG U
villaDtoTTV ^
)TT^ _
{UU 	
tryVV 
{WW 
ifXX 
(XX 
!XX 

ModelStateXX 
.XX  
IsValidXX  '
)XX' (
{YY 
	_responseZZ 
.ZZ 

StatusCodeZZ (
=ZZ) *
HttpStatusCodeZZ+ 9
.ZZ9 :

BadRequestZZ: D
;ZZD E
return[[ 

BadRequest[[ %
([[% &
	_response[[& /
)[[/ 0
;[[0 1
}\\ 
if]] 
(]] 
await]] 
_repo]] 
.]]  
GetAsync]]  (
(]]( )
x]]) *
=>]]+ -
x]]. /
.]]/ 0
Name]]0 4
.]]4 5
ToLower]]5 <
(]]< =
)]]= >
==]]? A
villaDto]]B J
.]]J K
Name]]K O
.]]O P
ToLower]]P W
(]]W X
)]]X Y
)]]Y Z
!=]][ ]
null]]^ b
)]]b c
{^^ 
	_response`` 
.`` 

StatusCode`` (
=``) *
HttpStatusCode``+ 9
.``9 :

BadRequest``: D
;``D E
returnaa 

BadRequestaa %
(aa% &
	_responseaa& /
)aa/ 0
;aa0 1
}bb 
ifcc 
(cc 
villaDtocc 
==cc 
nullcc  $
)cc$ %
{dd 
	_responseee 
.ee 

StatusCodeee (
=ee) *
HttpStatusCodeee+ 9
.ee9 :

BadRequestee: D
;eeD E
	_responseff 
.ff 
Resultff $
=ff% &
villaDtoff' /
;ff/ 0
returngg 

BadRequestgg %
(gg% &
	_responsegg& /
)gg/ 0
;gg0 1
}hh 
Villann 
villann 
=nn 
_mappernn %
.nn% &
Mapnn& )
<nn) *
Villann* /
>nn/ 0
(nn0 1
villaDtonn1 9
)nn9 :
;nn: ;
villaoo 
.oo 
CreatedDateoo !
=oo" #
DateTimeoo$ ,
.oo, -
UtcNowoo- 3
;oo3 4
awaitpp 
_repopp 
.pp 
CreateAsyncpp '
(pp' (
villapp( -
)pp- .
;pp. /
	_responseqq 
.qq 
Resultqq  
=qq! "
_mapperqq# *
.qq* +
Mapqq+ .
<qq. /
VillaDtoqq/ 7
>qq7 8
(qq8 9
villaqq9 >
)qq> ?
;qq? @
	_responserr 
.rr 

StatusCoderr $
=rr% &
HttpStatusCoderr' 5
.rr5 6
OKrr6 8
;rr8 9
returnss 
CreatedAtActionss &
(ss& '
$strss' 1
,ss1 2
newss3 6
{ss7 8
idss9 ;
=ss< =
villass> C
.ssC D
IdssD F
}ssG H
,ssH I
	_responsessJ S
)ssS T
;ssT U
}tt 
catchuu 
(uu 
	Exceptionuu 
exuu 
)uu  
{vv 
	_responseww 
.ww 
	IsSuccessww #
=ww$ %
falseww& +
;ww+ ,
	_responsexx 
.xx 
ErrorMessagesxx '
=yy 
newyy 
Listyy 
<yy 
stringyy %
>yy% &
(yy& '
)yy' (
{yy) *
exyy+ -
.yy- .
ToStringyy. 6
(yy6 7
)yy7 8
}yy9 :
;yy: ;
}zz 
return{{ 
	_response{{ 
;{{ 
}|| 	
[}} 	

HttpDelete}}	 
(}} 
$str}} 
,}} 
Name}}  $
=}}% &
$str}}' /
)}}/ 0
]}}0 1
[~~ 	 
ProducesResponseType~~	 
(~~ 
StatusCodes~~ )
.~~) *
Status200OK~~* 5
)~~5 6
]~~6 7
[ 	 
ProducesResponseType	 
( 
StatusCodes )
.) *
Status400BadRequest* =
)= >
]> ?
[
ÄÄ 	"
ProducesResponseType
ÄÄ	 
(
ÄÄ 
StatusCodes
ÄÄ )
.
ÄÄ) *
Status404NotFound
ÄÄ* ;
)
ÄÄ; <
]
ÄÄ< =
public
ÅÅ 
async
ÅÅ 
Task
ÅÅ 
<
ÅÅ 
ActionResult
ÅÅ &
<
ÅÅ& '
APIResponse
ÅÅ' 2
>
ÅÅ2 3
>
ÅÅ3 4
Delete
ÅÅ5 ;
(
ÅÅ; <
int
ÅÅ< ?
id
ÅÅ@ B
)
ÅÅB C
{
ÇÇ 	
try
ÉÉ 
{
ÑÑ 
if
ÖÖ 
(
ÖÖ 
id
ÖÖ 
<=
ÖÖ 
$num
ÖÖ 
)
ÖÖ 
{
ÜÜ 
	_response
àà 
.
àà 

StatusCode
àà (
=
àà) *
HttpStatusCode
àà+ 9
.
àà9 :

BadRequest
àà: D
;
ààD E
return
ââ 

BadRequest
ââ %
(
ââ% &
	_response
ââ& /
)
ââ/ 0
;
ââ0 1
}
ää 
var
ãã 
villa
ãã 
=
ãã 
await
ãã !
_repo
ãã" '
.
ãã' (
GetAsync
ãã( 0
(
ãã0 1
x
ãã1 2
=>
ãã3 5
x
ãã6 7
.
ãã7 8
Id
ãã8 :
==
ãã; =
id
ãã> @
)
ãã@ A
;
ããA B
if
åå 
(
åå 
villa
åå 
==
åå 
null
åå !
)
åå! "
{
çç 
	_response
éé 
.
éé 

StatusCode
éé (
=
éé) *
HttpStatusCode
éé+ 9
.
éé9 :
NotFound
éé: B
;
ééB C
return
èè 
NotFound
èè #
(
èè# $
	_response
èè$ -
)
èè- .
;
èè. /
}
êê 
await
ëë 
_repo
ëë 
.
ëë 
RemoveAsync
ëë '
(
ëë' (
villa
ëë( -
)
ëë- .
;
ëë. /
	_response
íí 
.
íí 

StatusCode
íí $
=
íí% &
HttpStatusCode
íí' 5
.
íí5 6
OK
íí6 8
;
íí8 9
	_response
ìì 
.
ìì 
	IsSuccess
ìì #
=
ìì$ %
true
ìì& *
;
ìì* +
return
îî 
Ok
îî 
(
îî 
	_response
îî #
)
îî# $
;
îî$ %
}
ïï 
catch
ññ 
(
ññ 
	Exception
ññ 
ex
ññ 
)
ññ  
{
óó 
	_response
òò 
.
òò 
	IsSuccess
òò #
=
òò$ %
false
òò& +
;
òò+ ,
	_response
ôô 
.
ôô 
ErrorMessages
ôô '
=
öö 
new
öö 
List
öö 
<
öö 
string
öö %
>
öö% &
(
öö& '
)
öö' (
{
öö) *
ex
öö+ -
.
öö- .
ToString
öö. 6
(
öö6 7
)
öö7 8
}
öö9 :
;
öö: ;
}
õõ 
return
úú 
	_response
úú 
;
úú 
}
ùù 	
[
ûû 	
HttpPut
ûû	 
(
ûû 
$str
ûû 
)
ûû 
]
ûû 
[
üü 	"
ProducesResponseType
üü	 
(
üü 
StatusCodes
üü )
.
üü) *
Status200OK
üü* 5
)
üü5 6
]
üü6 7
[
†† 	"
ProducesResponseType
††	 
(
†† 
StatusCodes
†† )
.
††) *!
Status400BadRequest
††* =
)
††= >
]
††> ?
public
°° 
async
°° 
Task
°° 
<
°° 
ActionResult
°° &
<
°°& '
APIResponse
°°' 2
>
°°2 3
>
°°3 4
Update
°°5 ;
(
°°; <
int
°°< ?
id
°°@ B
,
°°B C
[
°°D E
FromBody
°°E M
]
°°M N
VillaUpdateDto
°°O ]
villaDto
°°^ f
)
°°f g
{
¢¢ 	
try
££ 
{
§§ 
if
•• 
(
•• 
villaDto
•• 
==
•• 
null
••  $
||
••% '
id
••( *
!=
••+ -
villaDto
••. 6
.
••6 7
Id
••7 9
)
••9 :
{
¶¶ 
	_response
ßß 
.
ßß 

StatusCode
ßß (
=
ßß) *
HttpStatusCode
ßß+ 9
.
ßß9 :

BadRequest
ßß: D
;
ßßD E
return
®® 

BadRequest
®® %
(
®®% &
	_response
®®& /
)
®®/ 0
;
®®0 1
}
©© 
Villa
™™ 
villa
™™ 
=
™™ 
_mapper
™™ %
.
™™% &
Map
™™& )
<
™™) *
Villa
™™* /
>
™™/ 0
(
™™0 1
villaDto
™™1 9
)
™™9 :
;
™™: ;
await
´´ 
_repo
´´ 
.
´´ 
UpdateAsync
´´ '
(
´´' (
villa
´´( -
)
´´- .
;
´´. /
	_response
¨¨ 
.
¨¨ 

StatusCode
¨¨ $
=
¨¨% &
HttpStatusCode
¨¨' 5
.
¨¨5 6
OK
¨¨6 8
;
¨¨8 9
	_response
≠≠ 
.
≠≠ 
	IsSuccess
≠≠ #
=
≠≠$ %
true
≠≠& *
;
≠≠* +
return
ÆÆ 
Ok
ÆÆ 
(
ÆÆ 
	_response
ÆÆ #
)
ÆÆ# $
;
ÆÆ$ %
}
ØØ 
catch
∞∞ 
(
∞∞ 
	Exception
∞∞ 
ex
∞∞ 
)
∞∞  
{
±± 
	_response
≤≤ 
.
≤≤ 
	IsSuccess
≤≤ #
=
≤≤$ %
false
≤≤& +
;
≤≤+ ,
	_response
≥≥ 
.
≥≥ 
ErrorMessages
≥≥ '
=
¥¥ 
new
¥¥ 
List
¥¥ 
<
¥¥ 
string
¥¥ %
>
¥¥% &
(
¥¥& '
)
¥¥' (
{
¥¥) *
ex
¥¥+ -
.
¥¥- .
ToString
¥¥. 6
(
¥¥6 7
)
¥¥7 8
}
¥¥9 :
;
¥¥: ;
}
µµ 
return
∂∂ 
	_response
∂∂ 
;
∂∂ 
}
∑∑ 	
[
∏∏ 	
	HttpPatch
∏∏	 
]
∏∏ 
public
ππ 
async
ππ 
Task
ππ 
<
ππ 
IActionResult
ππ '
>
ππ' (
UpdatePartial
ππ) 6
(
ππ6 7
int
ππ7 :
id
ππ; =
,
ππ= >
JsonPatchDocument
ππ? P
<
ππP Q
VillaUpdateDto
ππQ _
>
ππ_ `
patch
ππa f
)
ππf g
{
∫∫ 	
if
ªª 
(
ªª 
patch
ªª 
==
ªª 
null
ªª 
||
ªª  
id
ªª! #
==
ªª$ &
$num
ªª' (
)
ªª( )
{
ºº 
return
ΩΩ 

BadRequest
ΩΩ !
(
ΩΩ! "
)
ΩΩ" #
;
ΩΩ# $
}
ææ 
var
øø 
villa
øø 
=
øø 
await
øø 
_repo
øø #
.
øø# $
GetAsync
øø$ ,
(
øø, -
x
øø- .
=>
øø/ 1
x
øø2 3
.
øø3 4
Id
øø4 6
==
øø7 9
id
øø: <
)
øø< =
;
øø= >
if
¿¿ 
(
¿¿ 
villa
¿¿ 
==
¿¿ 
null
¿¿ 
)
¿¿ 
{
¡¡ 
return
¬¬ 

BadRequest
¬¬ !
(
¬¬! "
)
¬¬" #
;
¬¬# $
}
√√ 
VillaUpdateDto
ƒƒ 
villaDto
ƒƒ #
=
ƒƒ$ %
_mapper
ƒƒ& -
.
ƒƒ- .
Map
ƒƒ. 1
<
ƒƒ1 2
VillaUpdateDto
ƒƒ2 @
>
ƒƒ@ A
(
ƒƒA B
villa
ƒƒB G
)
ƒƒG H
;
ƒƒH I
patch
≈≈ 
.
≈≈ 
ApplyTo
≈≈ 
(
≈≈ 
villaDto
≈≈ "
,
≈≈" #

ModelState
≈≈$ .
)
≈≈. /
;
≈≈/ 0
Villa
∆∆ 
model
∆∆ 
=
∆∆ 
_mapper
∆∆ !
.
∆∆! "
Map
∆∆" %
<
∆∆% &
Villa
∆∆& +
>
∆∆+ ,
(
∆∆, -
villaDto
∆∆- 5
)
∆∆5 6
;
∆∆6 7
await
«« 
_repo
«« 
.
«« 
UpdateAsync
«« #
(
««# $
model
««$ )
)
««) *
;
««* +
await
»» 
_repo
»» 
.
»» 
	SaveAsync
»» !
(
»»! "
)
»»" #
;
»»# $
if
…… 
(
…… 
!
…… 

ModelState
…… 
.
…… 
IsValid
…… #
)
……# $
{
   
return
ÀÀ 

BadRequest
ÀÀ !
(
ÀÀ! "
)
ÀÀ" #
;
ÀÀ# $
}
ÃÃ 
return
ÕÕ 
	NoContent
ÕÕ 
(
ÕÕ 
)
ÕÕ 
;
ÕÕ 
}
ŒŒ 	
}
–– 
}—— •}
ÅC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_VillaAPI\Controllers\VillaNumberAPIController.cs
	namespace		 	
MagicVilla_VillaAPI		
 
.		 
Controllers		 )
{

 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class $
VillaNumberAPIController )
:* +
ControllerBase, :
{ 
private 
readonly "
IVillaNumberRepository /
_repo0 5
;5 6
private 
readonly 
IVillaRepository )

_villaRepo* 4
;4 5
private 
readonly 
IMapper  
_mapper! (
;( )
	protected 
APIResponse 
	_response '
;' (
public $
VillaNumberAPIController '
(' ("
IVillaNumberRepository( >
repo? C
,C D
IMapperE L
mapperM S
,S T
IVillaRepositoryU e
	villaRepof o
)o p
{ 	
_repo 
= 
repo 
; 

_villaRepo 
= 
	villaRepo "
;" #
_mapper 
= 
mapper 
; 
	_response 
= 
new 
( 
) 
; 
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
ActionResult &
<& '
APIResponse' 2
>2 3
>3 4
GetAll5 ;
(; <
)< =
{ 	
try 
{ 
var   
villaNumber   
=    !
await  " '
_repo  ( -
.  - .
GetAllAsync  . 9
(  9 :
)  : ;
;  ; <
	_response!! 
.!! 
Result!!  
=!!! "
_mapper!!# *
.!!* +
Map!!+ .
<!!. /
VillaNumberDto!!/ =
>!!= >
(!!> ?
villaNumber!!? J
)!!J K
;!!K L
	_response"" 
."" 

StatusCode"" $
=""% &
HttpStatusCode""' 5
.""5 6
OK""6 8
;""8 9
return## 
Ok## 
(## 
	_response## #
)### $
;##$ %
}$$ 
catch%% 
(%% 
	Exception%% 
ex%% 
)%%  
{&& 
	_response'' 
.'' 
	IsSuccess'' #
=''$ %
false''& +
;''+ ,
	_response(( 
.(( 
ErrorMessages(( '
=)) 
new)) 
List)) 
<)) 
string)) %
>))% &
())& '
)))' (
{))) *
ex))+ -
.))- .
ToString)). 6
())6 7
)))7 8
}))9 :
;)): ;
return** 
Ok** 
(** 
	_response** #
)**# $
;**$ %
}++ 
}-- 	
[.. 	
HttpGet..	 
(.. 
$str.. 
,.. 
Name.. !
=.." #
$str..$ 4
)..4 5
]..5 6
public// 
async// 
Task// 
<// 
ActionResult// &
<//& '
APIResponse//' 2
>//2 3
>//3 4
Get//5 8
(//8 9
int//9 <
id//= ?
)//? @
{00 	
try11 
{22 
if33 
(33 
id33 
<=33 
$num33 
)33 
{44 
	_response55 
.55 

StatusCode55 (
=55) *
HttpStatusCode55+ 9
.559 :

BadRequest55: D
;55D E
return66 
Ok66 
(66 
	_response66 '
)66' (
;66( )
}77 
var88 
villaNumber88 
=88  !
await88" '
_repo88( -
.88- .
GetAsync88. 6
(886 7
x887 8
=>889 ;
x88< =
.88= >
VillaNo88> E
==88F H
id88I K
)88K L
;88L M
if99 
(99 
villaNumber99 
==99  "
null99# '
)99' (
{:: 
	_response;; 
.;; 

StatusCode;; (
=;;) *
HttpStatusCode;;+ 9
.;;9 :
NotFound;;: B
;;;B C
return<< 
Ok<< 
(<< 
	_response<< '
)<<' (
;<<( )
}== 
	_response>> 
.>> 
Result>>  
=>>! "
_mapper>># *
.>>* +
Map>>+ .
<>>. /
VillaNumberDto>>/ =
>>>= >
(>>> ?
villaNumber>>? J
)>>J K
;>>K L
	_response?? 
.?? 

StatusCode?? $
=??% &
HttpStatusCode??' 5
.??5 6
OK??6 8
;??8 9
return@@ 
Ok@@ 
(@@ 
	_response@@ #
)@@# $
;@@$ %
}AA 
catchBB 
(BB 
	ExceptionBB 
exBB 
)BB  
{CC 
	_responseDD 
.DD 
	IsSuccessDD #
=DD$ %
falseDD& +
;DD+ ,
	_responseEE 
.EE 
ErrorMessagesEE '
=EE( )
newEE* -
ListEE. 2
<EE2 3
stringEE3 9
>EE9 :
(EE: ;
)EE; <
{EE= >
exEE? A
.EEA B
ToStringEEB J
(EEJ K
)EEK L
}EEM N
;EEN O
returnFF 
OkFF 
(FF 
	_responseFF #
)FF# $
;FF$ %
}GG 
}HH 	
[II 	
HttpPostII	 
]II 
publicJJ 
asyncJJ 
TaskJJ 
<JJ 
ActionResultJJ &
<JJ& '
APIResponseJJ' 2
>JJ2 3
>JJ3 4
CreateJJ5 ;
(JJ; <
[JJ< =
FromBodyJJ= E
]JJE F 
VillaNumberCreateDtoJJG [
villaNumberCreateJJ\ m
)JJm n
{KK 	
tryLL 
{MM 
ifNN 
(NN 
!NN 

ModelStateNN 
.NN  
IsValidNN  '
)NN' (
{OO 
	_responsePP 
.PP 

StatusCodePP (
=PP) *
HttpStatusCodePP+ 9
.PP9 :

BadRequestPP: D
;PPD E
returnQQ 

BadRequestQQ %
(QQ% &
	_responseQQ& /
)QQ/ 0
;QQ0 1
}RR 
ifSS 
(SS 
awaitSS 
_repoSS 
.SS  
GetAsyncSS  (
(SS( )
xSS) *
=>SS+ -
xSS. /
.SS/ 0
VillaNoSS0 7
!=SS8 :
villaNumberCreateSS; L
.SSL M
VillaNoSSM T
)SST U
!=SSV X
nullSSY ]
)SS] ^
{TT 
	_responseUU 
.UU 

StatusCodeUU (
=UU) *
HttpStatusCodeUU+ 9
.UU9 :

BadRequestUU: D
;UUD E
returnVV 

BadRequestVV %
(VV% &
	_responseVV& /
)VV/ 0
;VV0 1
}WW 
ifXX 
(XX 
awaitXX 

_villaRepoXX $
.XX$ %
GetAsyncXX% -
(XX- .
xXX. /
=>XX0 2
xXX3 4
.XX4 5
IdXX5 7
==XX8 :
villaNumberCreateXX; L
.XXL M
VillaIdXXM T
)XXT U
!=XXV X
nullXXY ]
)XX] ^
{YY 
	_responseZZ 
.ZZ 

StatusCodeZZ (
=ZZ) *
HttpStatusCodeZZ+ 9
.ZZ9 :

BadRequestZZ: D
;ZZD E
return[[ 

BadRequest[[ %
([[% &
	_response[[& /
)[[/ 0
;[[0 1
}\\ 
if]] 
(]] 
villaNumberCreate]] %
==]]& (
null]]) -
)]]- .
{^^ 
	_response__ 
.__ 

StatusCode__ (
=__) *
HttpStatusCode__+ 9
.__9 :

BadRequest__: D
;__D E
returnaa 

BadRequestaa %
(aa% &
	_responseaa& /
)aa/ 0
;aa0 1
}bb 
VillaNumbercc 
villaNumbercc '
=cc( )
_mappercc* 1
.cc1 2
Mapcc2 5
<cc5 6
VillaNumbercc6 A
>ccA B
(ccB C
villaNumberCreateccC T
)ccT U
;ccU V
awaitdd 
_repodd 
.dd 
CreateAsyncdd '
(dd' (
villaNumberdd( 3
)dd3 4
;dd4 5
	_responseee 
.ee 
Resultee  
=ee! "
_mapperee# *
.ee* +
Mapee+ .
<ee. /
VillaNumberDtoee/ =
>ee= >
(ee> ?
villaNumberee? J
)eeJ K
;eeK L
	_responseff 
.ff 

StatusCodeff $
=ff% &
HttpStatusCodeff' 5
.ff5 6
OKff6 8
;ff8 9
	_responsegg 
.gg 
	IsSuccessgg #
=gg$ %
truegg& *
;gg* +
returnhh 
CreatedAtActionhh &
(hh& '
$strhh' 7
,hh7 8
newhh9 <
{hh= >
idhh? A
=hhB C
villaNumberhhD O
.hhO P
VillaNohhP W
}hhX Y
,hhY Z
	_responsehh[ d
)hhd e
;hhe f
}ii 
catchjj 
(jj 
	Exceptionjj 
exjj 
)jj  
{kk 
	_responsell 
.ll 
	IsSuccessll #
=ll$ %
falsell& +
;ll+ ,
	_responsemm 
.mm 
ErrorMessagesmm '
=mm( )
newmm* -
Listmm. 2
<mm2 3
stringmm3 9
>mm9 :
(mm: ;
)mm; <
{mm= >
exmm? A
.mmA B
ToStringmmB J
(mmJ K
)mmK L
}mmM N
;mmN O
returnnn 
Oknn 
(nn 
	_responsenn #
)nn# $
;nn$ %
}oo 
}pp 	
[qq 	

HttpDeleteqq	 
(qq 
$strqq 
,qq 
Nameqq  $
=qq% &
$strqq' :
)qq: ;
]qq; <
publicrr 
asyncrr 
Taskrr 
<rr 
ActionResultrr &
<rr& '
APIResponserr' 2
>rr2 3
>rr3 4
Deleterr5 ;
(rr; <
intrr< ?
idrr@ B
)rrB C
{ss 	
trytt 
{uu 
ifvv 
(vv 
idvv 
<=vv 
$numvv 
)vv 
{ww 
	_responsexx 
.xx 

StatusCodexx (
=xx) *
HttpStatusCodexx+ 9
.xx9 :

BadRequestxx: D
;xxD E
returnyy 

BadRequestyy %
(yy% &
	_responseyy& /
)yy/ 0
;yy0 1
}zz 
var{{ 
villaNumber{{ 
={{  !
await{{" '
_repo{{( -
.{{- .
GetAsync{{. 6
({{6 7
x{{7 8
=>{{9 ;
x{{< =
.{{= >
VillaNo{{> E
=={{F H
id{{I K
){{K L
;{{L M
if|| 
(|| 
villaNumber|| 
==||  "
null||# '
)||' (
{}} 
	_response~~ 
.~~ 

StatusCode~~ (
=~~) *
HttpStatusCode~~+ 9
.~~9 :
NotFound~~: B
;~~B C
return 
NotFound #
(# $
	_response$ -
)- .
;. /
}
ÄÄ 
await
ÅÅ 
_repo
ÅÅ 
.
ÅÅ 
RemoveAsync
ÅÅ '
(
ÅÅ' (
villaNumber
ÅÅ( 3
)
ÅÅ3 4
;
ÅÅ4 5
	_response
ÇÇ 
.
ÇÇ 

StatusCode
ÇÇ $
=
ÇÇ% &
HttpStatusCode
ÇÇ' 5
.
ÇÇ5 6
OK
ÇÇ6 8
;
ÇÇ8 9
	_response
ÉÉ 
.
ÉÉ 
	IsSuccess
ÉÉ #
=
ÉÉ$ %
true
ÉÉ& *
;
ÉÉ* +
return
ÑÑ 
Ok
ÑÑ 
(
ÑÑ 
	_response
ÑÑ #
)
ÑÑ# $
;
ÑÑ$ %
}
ÖÖ 
catch
ÜÜ 
(
ÜÜ 
	Exception
ÜÜ 
ex
ÜÜ 
)
ÜÜ  
{
áá 
	_response
àà 
.
àà 
	IsSuccess
àà #
=
àà$ %
false
àà& +
;
àà+ ,
	_response
ââ 
.
ââ 
ErrorMessages
ââ '
=
ää 
new
ää 
List
ää 
<
ää 
string
ää %
>
ää% &
(
ää& '
)
ää' (
{
ää) *
ex
ää+ -
.
ää- .
ToString
ää. 6
(
ää6 7
)
ää7 8
}
ää9 :
;
ää: ;
return
ãã 
	_response
ãã  
;
ãã  !
}
åå 
}
çç 	
[
éé 	
HttpPut
éé	 
(
éé 
$str
éé 
)
éé 
]
éé 
public
èè 
async
èè 
Task
èè 
<
èè 
ActionResult
èè &
<
èè& '
APIResponse
èè' 2
>
èè2 3
>
èè3 4
Update
èè5 ;
(
èè; <
int
èè< ?
id
èè@ B
,
èèB C
[
èèD E
FromBody
èèE M
]
èèM N"
VillaNumberUpdateDto
èèO c
villaNumberUpdate
èèd u
)
èèu v
{
êê 	
try
ëë 
{
íí 
if
ìì 
(
ìì 
villaNumberUpdate
ìì %
==
ìì& (
null
ìì) -
||
ìì. 0
id
ìì1 3
!=
ìì4 6
villaNumberUpdate
ìì7 H
.
ììH I
VillaNo
ììI P
)
ììP Q
{
îî 
	_response
ïï 
.
ïï 

StatusCode
ïï (
=
ïï) *
HttpStatusCode
ïï+ 9
.
ïï9 :

BadRequest
ïï: D
;
ïïD E
return
ññ 

BadRequest
ññ %
(
ññ% &
	_response
ññ& /
)
ññ/ 0
;
ññ0 1
}
óó 
VillaNumber
òò 
villaNumber
òò '
=
òò( )
_mapper
òò* 1
.
òò1 2
Map
òò2 5
<
òò5 6
VillaNumber
òò6 A
>
òòA B
(
òòB C
villaNumberUpdate
òòC T
)
òòT U
;
òòU V
await
ôô 
_repo
ôô 
.
ôô 
UpdateAsync
ôô '
(
ôô' (
villaNumber
ôô( 3
)
ôô3 4
;
ôô4 5
	_response
öö 
.
öö 

StatusCode
öö $
=
öö% &
HttpStatusCode
öö' 5
.
öö5 6
OK
öö6 8
;
öö8 9
	_response
õõ 
.
õõ 
	IsSuccess
õõ #
=
õõ$ %
true
õõ& *
;
õõ* +
return
úú 
Ok
úú 
(
úú 
	_response
úú #
)
úú# $
;
úú$ %
}
ùù 
catch
ûû 
(
ûû 
	Exception
ûû 
ex
ûû 
)
ûû  
{
üü 
	_response
†† 
.
†† 
	IsSuccess
†† #
=
††$ %
false
††& +
;
††+ ,
	_response
°° 
.
°° 
ErrorMessages
°° '
=
¢¢ 
new
¢¢ 
List
¢¢ 
<
¢¢ 
string
¢¢ %
>
¢¢% &
(
¢¢& '
)
¢¢' (
{
¢¢) *
ex
¢¢+ -
.
¢¢- .
ToString
¢¢. 6
(
¢¢6 7
)
¢¢7 8
}
¢¢9 :
;
¢¢: ;
return
££ 
	_response
££  
;
££  !
}
§§ 
}
•• 	
}
¶¶ 
}ßß ‡
ãC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_VillaAPI\DependencyInjection\ServiceCollectionExtension.cs
	namespace 	
MagicVilla_VillaAPI
 
. 
DependencyInjection 1
{ 
public		 

static		 
class		 &
ServiceCollectionExtension		 2
{

 
public 
static 
IServiceCollection (
AddDataBase) 4
(4 5
this5 9
IServiceCollection: L
servicesM U
,U V
IConfigurationV d
configuratione r
)r s
{ 	
AddDbContext 
( 
services !
,! "
configuration# 0
)0 1
;1 2
services 
. 
	AddScoped 
< 
IUnitOfWork *
,* +

UnitOfWork, 6
>6 7
(7 8
)8 9
;9 :
return 
services 
; 
} 	
public 
static 
IServiceCollection (
AddDomainService) 9
(9 :
this: >
IServiceCollection? Q
servicesR Z
)Z [
{ 	
services 
. 
AddSingleton !
<! "
ILogging" *
,* +
Logging, 3
>3 4
(4 5
)5 6
;6 7
services 
. 
	AddScoped 
< 
IVillaRepository /
,/ 0
VillaRepository1 @
>@ A
(A B
)B C
;C D
services 
. 
	AddScoped 
< "
IVillaNumberRepository 5
,5 6!
VillaNumberRepository7 L
>L M
(M N
)N O
;O P
return 
services 
; 
} 	
public 
static 
IServiceCollection (
AddDbContext) 5
(5 6
this6 :
IServiceCollection; M
servicesN V
,V W
IConfigurationX f
configurationg t
)t u
{ 	
var 
isProduction 
= 
configuration ,
., -
GetValue- 5
<5 6
bool6 :
>: ;
(; <
$str< J
)J K
;K L
if 
( 
isProduction 
) 
{ 
services 
. 
AddDbContext %
<% & 
ApplicationDbContext& :
>: ;
(; <
option< B
=>C E
{ 
option   
.   
UseSqlServer   '
(  ' (
configuration  ( 5
.  5 6
GetConnectionString  6 I
(  I J
$str  J ]
)  ] ^
)  ^ _
;  _ `
}!! 
)!! 
;!! 
}"" 
else## 
{$$ 
services%% 
.%% 
AddDbContext%% %
<%%% & 
ApplicationDbContext%%& :
>%%: ;
(%%; <
option%%< B
=>%%C E
{&& 
option'' 
.'' 
UseSqlServer'' '
(''' (
configuration''( 5
.''5 6
GetConnectionString''6 I
(''I J
$str''J ]
)''] ^
)''^ _
;''_ `
}(( 
)(( 
;(( 
})) 
return** 
services** 
;** 
}++ 	
},, 
}-- Ç
lC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_VillaAPI\Logger\ILogging.cs
	namespace 	
MagicVilla_VillaAPI
 
. 
Logger $
{ 
public 

	interface 
ILogging 
{ 
public 
void 
Log 
( 
string 
message &
,& '
string( .
type/ 3
)3 4
;4 5
} 
} ì
kC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_VillaAPI\Logger\Logging.cs
	namespace 	
MagicVilla_VillaAPI
 
. 
Logger $
{ 
public 

class 
Logging 
: 
ILogging #
{ 
public 
void 
Log 
( 
string 
message &
,& '
string( .
type/ 3
)3 4
{ 	
if 
( 
type 
== 
$str 
)  
{ 
Console		 
.		 
BackgroundColor		 '
=		( )
ConsoleColor		* 6
.		6 7
Red		7 :
;		: ;
Console

 
.

 
	WriteLine

 !
(

! "
$str

" ,
+

- .
message

/ 6
)

6 7
;

7 8
Console 
. 
BackgroundColor '
=( )
ConsoleColor* 6
.6 7
Black7 <
;< =
} 
else 
if 
( 
type 
== 
$str &
)& '
{ 
Console 
. 
BackgroundColor '
=( )
ConsoleColor* 6
.6 7
Red7 :
;: ;
Console 
. 
	WriteLine !
(! "
$str" .
+/ 0
message1 8
)8 9
;9 :
Console 
. 
BackgroundColor '
=( )
ConsoleColor* 6
.6 7
Black7 <
;< =
} 
else 
{ 
Console 
. 
	WriteLine !
(! "
message" )
)) *
;* +
} 
} 	
} 
} º
lC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_VillaAPI\Mapper\Profiles.cs
	namespace 	
MagicVilla_VillaAPI
 
. 
Mapper $
{ 
public 

class 
Profiles 
: 
Profile "
{ 
public		 
Profiles		 
(		 
)		 
{

 	
	CreateMap 
< 
Villa 
, 
VillaDto %
>% &
(& '
)' (
.( )

ReverseMap) 3
(3 4
)4 5
;5 6
	CreateMap 
< 
VillaCreateDto $
,$ %
Villa& +
>+ ,
(, -
)- .
.. /

ReverseMap/ 9
(9 :
): ;
;; <
	CreateMap 
< 
VillaUpdateDto $
,$ %
Villa& +
>+ ,
(, -
)- .
.. /

ReverseMap/ 9
(9 :
): ;
;; <
	CreateMap 
< 
VillaNumber !
,! "
VillaNumberDto# 1
>1 2
(2 3
)3 4
.4 5

ReverseMap5 ?
(? @
)@ A
;A B
	CreateMap 
<  
VillaNumberCreateDto *
,* +
VillaNumber, 7
>7 8
(8 9
)9 :
.: ;

ReverseMap; E
(E F
)F G
;G H
	CreateMap 
<  
VillaNumberUpdateDto *
,* +
VillaNumber, 7
>7 8
(8 9
)9 :
.: ;

ReverseMap; E
(E F
)F G
;G H
} 	
} 
} ç
ÅC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_VillaAPI\Middleware\CustomExceptionMiddleware.cs
	namespace 	

SkillCheck
 
. 

Middleware 
{ 
public 

class %
CustomExceptionMiddleware *
{ 
private		 
readonly		 
RequestDelegate		 (
_next		) .
;		. /
public

 %
CustomExceptionMiddleware

 (
(

( )
RequestDelegate

) 8
next

9 =
)

= >
{ 	
_next 
= 
next 
; 
} 	
public 
async 
Task 
InvokeAsync %
(% &
HttpContext& 1
context2 9
)9 :
{ 	
try 
{ 
await 
_next 
( 
context #
)# $
;$ %
} 
catch 
( 
	Exception 
ex 
)  
{ 
await  
HandleExceptionAsync *
(* +
context+ 2
,2 3
ex4 6
)6 7
;7 8
} 
} 	
private 
async 
Task  
HandleExceptionAsync /
(/ 0
HttpContext0 ;
context< C
,C D
	ExceptionE N
	exceptionO X
)X Y
{ 	
context 
. 
Response 
. 
ContentType (
=) *
$str+ =
;= >
var 
response 
= 
context "
." #
Response# +
;+ ,
var!! 
errorResponse!! 
=!! 
new!!  #
ErrorResponse!!$ 1
{"" 
Success## 
=## 
false## 
}$$ 
;$$ 
switch%% 
(%% 
	exception%% 
)%% 
{&& 
case''  
ApplicationException'' )
ex''* ,
:'', -
response(( 
.(( 

StatusCode(( '
=((( )
(((* +
int((+ .
)((. /
HttpStatusCode((/ =
.((= >

BadRequest((> H
;((H I
errorResponse)) !
.))! "
Message))" )
=))* +
ex)), .
.)). /
Message))/ 6
;))6 7
break** 
;** 
default++ 
:++ 
response,, 
.,, 

StatusCode,, '
=,,( )
(,,* +
int,,+ .
),,. /
HttpStatusCode,,/ =
.,,= >
InternalServerError,,> Q
;,,Q R
errorResponse-- !
.--! "
Message--" )
=--* +
$"--, .
$str--. =
{--= >
	exception--> G
.--G H
Message--H O
}--O P
$str--P a
{--a b
	exception--b k
.--k l

StackTrace--l v
}--v w
"--w x
;--x y
break.. 
;.. 
}// 
var00 
result00 
=00 
JsonSerializer00 '
.00' (
	Serialize00( 1
(001 2
errorResponse002 ?
)00? @
;00@ A
await11 
context11 
.11 
Response11 "
.11" #

WriteAsync11# -
(11- .
result11. 4
)114 5
;115 6
}22 	
}33 
}44 ∫
ãC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_VillaAPI\Middleware\CustomExceptionMiddlewareExtensions.cs
	namespace 	

SkillCheck
 
. 

Middleware 
{ 
public 

static 
class /
#CustomExceptionMiddlewareExtensions ;
{ 
public 
static 
IApplicationBuilder )(
UseCustomExceptionMiddleware* F
(F G
thisG K
IApplicationBuilderL _
app` c
)c d
{ 	
return 
app 
. 
UseMiddleware $
<$ %%
CustomExceptionMiddleware% >
>> ?
(? @
)@ A
;A B
} 	
}		 
}

 ¯
dC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_VillaAPI\Program.cs
	namespace 	
MagicVilla_VillaAPI
 
{ 
public 

class 
Program 
{		 
public

 
static

 
void

 
Main

 
(

  
string

  &
[

& '
]

' (
args

) -
)

- .
{ 	
var 
builder 
= 
WebApplication (
.( )
CreateBuilder) 6
(6 7
args7 ;
); <
;< =
builder 
. 
Services 
. 
AddControllers +
(+ ,
), -
;- .
builder 
. 
Services 
. #
AddEndpointsApiExplorer 4
(4 5
)5 6
;6 7
builder 
. 
Services 
. 
AddSwaggerGen *
(* +
options+ 2
=>3 5
{ 
options 
. 

SwaggerDoc "
(" #
$str# '
,' (
new) ,
OpenApiInfo- 8
{ 
Title 
= 
$str ,
,, -
Version 
= 
$str "
," #
Contact 
= 
new !
OpenApiContact" 0
{ 
Name 
= 
$str '
,' (
Email 
= 
$str  8
} 
, 
} 
) 
; 
} 
) 
; 
builder   
.   
Services   
.   
AddDataBase   (
(  ( )
builder  ) 0
.  0 1
Configuration  1 >
)  > ?
.!! 
AddAutoMapper!! 
(!! 
typeof!! %
(!!% &
Profiles!!& .
)!!. /
.!!/ 0
Assembly!!0 8
)!!8 9
."" 
AddDomainService"" !
(""! "
)""" #
;""# $
var$$ 
app$$ 
=$$ 
builder$$ 
.$$ 
Build$$ #
($$# $
)$$$ %
;$$% &
if'' 
('' 
app'' 
.'' 
Environment'' 
.''  
IsDevelopment''  -
(''- .
)''. /
)''/ 0
{(( 
app)) 
.)) 

UseSwagger)) 
()) 
)))  
;))  !
app** 
.** 
UseSwaggerUI**  
(**  !
)**! "
;**" #
}++ 
app-- 
.-- 
UseHttpsRedirection-- #
(--# $
)--$ %
;--% &
app// 
.// 
UseAuthorization//  
(//  !
)//! "
;//" #
app11 
.11 (
UseCustomExceptionMiddleware11 ,
(11, -
)11- .
;11. /
app33 
.33 
MapControllers33 
(33 
)33  
;33  !
app55 
.55 
Run55 
(55 
)55 
;55 
}77 	
}88 
}99 