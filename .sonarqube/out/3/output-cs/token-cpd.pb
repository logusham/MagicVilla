‡
ÇC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_DataRepository\DataAccess\ApplicationDbContext.cs
	namespace 	
MagicVilla_VillaAPI
 
. 
Data "
{ 
public 

class  
ApplicationDbContext %
:& '
	DbContext( 1
{ 
public  
ApplicationDbContext #
(# $
DbContextOptions$ 4
<4 5 
ApplicationDbContext5 I
>I J
optionsK R
)R S
:S T
baseT X
(X Y
optionsY `
)` a
{		 	
} 	
public 
DbSet 
< 
Villa 
> 
Villas "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
DbSet 
< 
VillaNumber  
>  !
VillaNumbers" .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
modelBuilder 
. 
Entity 
<  
Villa  %
>% &
(& '
)' (
.( )
HasData) 0
(0 1
new 
Villa 
( 
) 
{ 
Id 
= 
$num 
, 
Name 
= 
$str (
,( )
Details 
= 
$str >
,> ?
ImageUrl 
= 
$str i
,i j
	Occupancy 
= 
$num  !
,! "
Rate 
= 
$num 
, 
Sqft 
= 
$num 
, 
Amenity 
= 
$str  
,  !
CreatedDate 
=  !
DateTime" *
.* +
Now+ .
} 
) 
; 
} 	
}   
}!! É
èC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_DataRepository\DataRepository\GenericRepository\IRepository.cs
	namespace 	
MagicVilla_VillaAPI
 
. 

Repository (
.( )
IRepository) 4
{ 
public 

	interface 
IRepository  
<  !
T! "
>" #
where$ )
T* +
:, -
class. 3
{ 
Task 
< 
List 
< 
T 
> 
> 
GetAllAsync !
(! "

Expression" ,
<, -
Func- 1
<1 2
T2 3
,3 4
bool5 9
>9 :
>: ;
?; <
filter= C
=D E
nullF J
)J K
;K L
Task 
< 
T 
> 
GetAsync 
( 

Expression #
<# $
Func$ (
<( )
T) *
,* +
bool, 0
>0 1
>1 2
filter3 9
=: ;
null< @
,@ A
boolB F
trackedG N
=O P
trueQ U
)U V
;V W
Task		 
CreateAsync		 
(		 
T		 
entity		 !
)		! "
;		" #
Task

 
RemoveAsync

 
(

 
T

 
entity

 !
)

! "
;

" #
Task 
	SaveAsync 
( 
) 
; 
} 
} …$
éC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_DataRepository\DataRepository\GenericRepository\Repository.cs
	namespace 	
MagicVilla_VillaAPI
 
. 

Repository (
{ 
public		 

class		 

Repository		 
<		 
T		 
>		 
:		  
IRepository		! ,
<		, -
T		- .
>		. /
where		0 5
T		6 7
:		8 9
class		: ?
{

 
	protected 
readonly  
ApplicationDbContext /
_db0 3
;3 4
public 

Repository 
(  
ApplicationDbContext .
db/ 1
)1 2
{ 	
_db 
= 
db 
; 
} 	
public 
async 
Task 
CreateAsync %
(% &
T& '
entity( .
). /
{ 	
await 
_db 
. 
Set 
< 
T 
> 
( 
) 
. 
AddAsync '
(' (
entity( .
). /
;/ 0
await 
	SaveAsync 
( 
) 
; 
} 	
public 
async 
Task 
< 
T 
> 
GetAsync %
(% &

Expression& 0
<0 1
Func1 5
<5 6
T6 7
,7 8
bool9 =
>= >
>> ?
?? @
filterA G
=H I
nullJ N
,N O
boolP T
trackedU \
=] ^
true_ c
)c d
{ 	

IQueryable 
< 
T 
> 
query 
=  !
_db" %
.% &
Set& )
<) *
T* +
>+ ,
(, -
)- .
;. /
if 
( 
! 
tracked 
) 
{ 
query 
= 
query 
. 
AsNoTracking *
(* +
)+ ,
;, -
} 
if 
( 
filter 
!= 
null 
) 
{ 
query 
= 
query 
. 
Where #
(# $
filter$ *
)* +
;+ ,
}   
return!! 
await!! 
query!! 
.!! 
FirstOrDefaultAsync!! 2
(!!2 3
)!!3 4
;!!4 5
}"" 	
public$$ 
async$$ 
Task$$ 
<$$ 
List$$ 
<$$ 
T$$  
>$$  !
>$$! "
GetAllAsync$$# .
($$. /

Expression$$/ 9
<$$9 :
Func$$: >
<$$> ?
T$$? @
,$$@ A
bool$$B F
>$$F G
>$$G H
?$$H I
filter$$J P
=$$Q R
null$$S W
)$$W X
{%% 	

IQueryable&& 
<&& 
T&& 
>&& 
query&& 
=&&  !
_db&&" %
.&&% &
Set&&& )
<&&) *
T&&* +
>&&+ ,
(&&, -
)&&- .
;&&. /
if'' 
('' 
filter'' 
!='' 
null'' 
)'' 
{(( 
query)) 
=)) 
query)) 
.)) 
Where)) #
())# $
filter))$ *
)))* +
;))+ ,
}** 
return++ 
await++ 
query++ 
.++ 
ToListAsync++ *
(++* +
)+++ ,
;++, -
},, 	
public.. 
async.. 
Task.. 
	SaveAsync.. #
(..# $
)..$ %
{// 	
await00 
_db00 
.00 
SaveChangesAsync00 &
(00& '
)00' (
;00( )
}11 	
public33 
async33 
Task33 
RemoveAsync33 %
(33% &
T33& '
entity33( .
)33. /
{44 	
_db55 
.55 
Set55 
<55 
T55 
>55 
(55 
)55 
.55 
Remove55 
(55  
entity55  &
)55& '
;55' (
await66 
	SaveAsync66 
(66 
)66 
;66 
}77 	
}88 
}99 »
ãC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_DataRepository\DataRepository\Implementation\UnitOfWork.cs
	namespace 	
MagicVilla_VillaAPI
 
. 

Repository (
{ 
public 

class 

UnitOfWork 
: 
IUnitOfWork )
{ 
public		 "
IVillaNumberRepository		 %!
VillaNumberRepository		& ;
{		< =
get		> A
;		A B
}		C D
public 
IVillaRepository 
VillaRepository  /
{0 1
get2 5
;5 6
}7 8
private 
readonly  
ApplicationDbContext -
_db. 1
;1 2
public 

UnitOfWork 
(  
ApplicationDbContext .
db/ 1
,1 2"
IVillaNumberRepository2 H
villaNumberI T
,T U
IVillaRepositoryU e
villaf k
)k l
{ 	!
VillaNumberRepository !
=" #
villaNumber$ /
;/ 0
VillaRepository 
= 
villa #
;# $
_db 
= 
db 
; 
} 	
public 
void 
Dispose 
( 
) 
{ 	
Dispose 
( 
true 
) 
; 
GC 
. 
SuppressFinalize 
(  
this  $
)$ %
;% &
} 	
public 
void 
Save 
( 
) 
{ 	
_db 
. 
SaveChanges 
( 
) 
; 
} 	
	protected   
virtual   
void   
Dispose   &
(  & '
bool  ' +
	disposing  , 5
)  5 6
{!! 	
if"" 
("" 
	disposing"" 
)"" 
{## 
_db$$ 
.$$ 
Dispose$$ 
($$ 
)$$ 
;$$ 
}%% 
}&& 	
}'' 
}(( º
ñC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_DataRepository\DataRepository\Implementation\VillaNumberRepository.cs
	namespace 	
MagicVilla_VillaAPI
 
. 

Repository (
{ 
public 

class !
VillaNumberRepository &
:' (

Repository) 3
<3 4
VillaNumber4 ?
>? @
,@ A"
IVillaNumberRepositoryA W
{ 
public		 !
VillaNumberRepository		 $
(		$ % 
ApplicationDbContext		% 9
db		: <
)		< =
:		> ?
base		@ D
(		D E
db		E G
)		G H
{

 	
} 	
public 
async 
Task 
< 
VillaNumber %
>% &
UpdateAsync' 2
(2 3
VillaNumber3 >
entity? E
)E F
{ 	
entity 
. 
UpdatedDate 
=  
DateTime! )
.) *
Now* -
;- .
_db 
. 
VillaNumbers 
. 
Update #
(# $
entity$ *
)* +
;+ ,
await 
_db 
. 
SaveChangesAsync &
(& '
)' (
;( )
return 
await 
Task 
. 

FromResult (
(( )
entity) /
)/ 0
;0 1
} 	
} 
} å
êC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_DataRepository\DataRepository\Implementation\VillaRepository.cs
	namespace 	
MagicVilla_VillaAPI
 
. 

Repository (
{ 
public		 

class		 
VillaRepository		  
:		! "

Repository		# -
<		- .
Villa		. 3
>		3 4
,		4 5
IVillaRepository		6 F
{

 
public 
VillaRepository 
(  
ApplicationDbContext 3
db4 6
)6 7
:8 9
base: >
(> ?
db? A
)A B
{ 	
} 	
public 
async 
Task 
< 
Villa 
>  
UpdateAsync! ,
(, -
Villa- 2
entity3 9
)9 :
{ 	
entity 
. 
UpdatedData 
=  
DateTime! )
.) *
Now* -
;- .
_db 
. 
Villas 
. 
Update 
( 
entity $
)$ %
;% &
await 
_db 
. 
SaveChangesAsync &
(& '
)' (
;( )
return 
await 
Task 
. 

FromResult (
(( )
entity) /
)/ 0
;0 1
} 	
} 
} Ç
áC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_DataRepository\DataRepository\Interface\IUnitOfWork.cs
	namespace 	
MagicVilla_VillaAPI
 
. 

Repository (
.( )
IRepository) 4
{ 
public 

	interface 
IUnitOfWork  
:! "
IDisposable# .
{ "
IVillaNumberRepository !
VillaNumberRepository 4
{5 6
get7 :
;: ;
}< =
IVillaRepository 
VillaRepository (
{) *
get+ .
;. /
}0 1
void 
Save 
( 
) 
; 
} 
}		 º
íC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_DataRepository\DataRepository\Interface\IVillaNumberRepository.cs
	namespace 	
MagicVilla_VillaAPI
 
. 

Repository (
.( )
IRepository) 4
{ 
public 

	interface "
IVillaNumberRepository +
:, -
IRepository. 9
<9 :
VillaNumber: E
>E F
{ 
Task 
< 
VillaNumber 
> 
UpdateAsync %
(% &
VillaNumber& 1
entity2 8
)8 9
;9 :
} 
}		 û
åC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_DataRepository\DataRepository\Interface\IVillaRepository.cs
	namespace 	
MagicVilla_VillaAPI
 
. 

Repository (
.( )
IRepository) 4
{ 
public 

	interface 
IVillaRepository %
:& '
IRepository( 3
<3 4
Villa4 9
>9 :
{ 
Task 
< 
Villa 
> 
UpdateAsync 
(  
Villa  %
entity& ,
), -
;- .
} 
}		 Ø>
èC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_DataRepository\Migrations\20230510045752_Cuncurrency Update.cs
	namespace 	%
MagicVilla_DataRepository
 #
.# $

Migrations$ .
{ 
public		 

partial		 
class		 
CuncurrencyUpdate		 *
:		+ ,
	Migration		- 6
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 E
,E F
nullableG O
:O P
falseQ V
)V W
,W X
Details 
= 
table #
.# $
Column$ *
<* +
string+ 1
>1 2
(2 3
type3 7
:7 8
$str9 H
,H I
nullableJ R
:R S
trueT X
)X Y
,Y Z
Rate 
= 
table  
.  !
Column! '
<' (
double( .
>. /
(/ 0
type0 4
:4 5
$str6 =
,= >
nullable? G
:G H
falseI N
)N O
,O P
Sqft 
= 
table  
.  !
Column! '
<' (
int( +
>+ ,
(, -
type- 1
:1 2
$str3 8
,8 9
nullable: B
:B C
falseD I
)I J
,J K
	Occupancy 
= 
table  %
.% &
Column& ,
<, -
int- 0
>0 1
(1 2
type2 6
:6 7
$str8 =
,= >
nullable? G
:G H
falseI N
)N O
,O P
ImageUrl 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: I
,I J
nullableK S
:S T
trueU Y
)Y Z
,Z [
Amenity 
= 
table #
.# $
Column$ *
<* +
string+ 1
>1 2
(2 3
type3 7
:7 8
$str9 H
,H I
nullableJ R
:R S
trueT X
)X Y
,Y Z
CreatedDate 
=  !
table" '
.' (
Column( .
<. /
DateTime/ 7
>7 8
(8 9
type9 =
:= >
$str? J
,J K
nullableL T
:T U
falseV [
)[ \
,\ ]
UpdatedData 
=  !
table" '
.' (
Column( .
<. /
DateTime/ 7
>7 8
(8 9
type9 =
:= >
$str? J
,J K
nullableL T
:T U
falseV [
)[ \
} 
, 
constraints 
: 
table "
=># %
{ 
table   
.   

PrimaryKey   $
(  $ %
$str  % 0
,  0 1
x  2 3
=>  4 6
x  7 8
.  8 9
Id  9 ;
)  ; <
;  < =
}!! 
)!! 
;!! 
migrationBuilder## 
.## 
CreateTable## (
(##( )
name$$ 
:$$ 
$str$$ $
,$$$ %
columns%% 
:%% 
table%% 
=>%% !
new%%" %
{&& 
VillaNo'' 
='' 
table'' #
.''# $
Column''$ *
<''* +
int''+ .
>''. /
(''/ 0
type''0 4
:''4 5
$str''6 ;
,''; <
nullable''= E
:''E F
false''G L
)''L M
,''M N
VillaId(( 
=(( 
table(( #
.((# $
Column(($ *
<((* +
int((+ .
>((. /
(((/ 0
type((0 4
:((4 5
$str((6 ;
,((; <
nullable((= E
:((E F
false((G L
)((L M
,((M N
SpecialDetails)) "
=))# $
table))% *
.))* +
Column))+ 1
<))1 2
string))2 8
>))8 9
())9 :
type)): >
:))> ?
$str))@ O
,))O P
nullable))Q Y
:))Y Z
false))[ `
)))` a
,))a b
CreatedDate** 
=**  !
table**" '
.**' (
Column**( .
<**. /
DateTime**/ 7
>**7 8
(**8 9
type**9 =
:**= >
$str**? J
,**J K
nullable**L T
:**T U
false**V [
)**[ \
,**\ ]
UpdatedDate++ 
=++  !
table++" '
.++' (
Column++( .
<++. /
DateTime++/ 7
>++7 8
(++8 9
type++9 =
:++= >
$str++? J
,++J K
nullable++L T
:++T U
false++V [
)++[ \
},, 
,,, 
constraints-- 
:-- 
table-- "
=>--# %
{.. 
table// 
.// 

PrimaryKey// $
(//$ %
$str//% 6
,//6 7
x//8 9
=>//: <
x//= >
.//> ?
VillaNo//? F
)//F G
;//G H
table00 
.00 

ForeignKey00 $
(00$ %
name11 
:11 
$str11 >
,11> ?
column22 
:22 
x22  !
=>22" $
x22% &
.22& '
VillaId22' .
,22. /
principalTable33 &
:33& '
$str33( 0
,330 1
principalColumn44 '
:44' (
$str44) -
,44- .
onDelete55  
:55  !
ReferentialAction55" 3
.553 4
Cascade554 ;
)55; <
;55< =
}66 
)66 
;66 
migrationBuilder88 
.88 
CreateIndex88 (
(88( )
name99 
:99 
$str99 /
,99/ 0
table:: 
::: 
$str:: %
,::% &
column;; 
:;; 
$str;; !
);;! "
;;;" #
}<< 	
	protected?? 
override?? 
void?? 
Down??  $
(??$ %
MigrationBuilder??% 5
migrationBuilder??6 F
)??F G
{@@ 	
migrationBuilderAA 
.AA 
	DropTableAA &
(AA& '
nameBB 
:BB 
$strBB $
)BB$ %
;BB% &
migrationBuilderDD 
.DD 
	DropTableDD &
(DD& '
nameEE 
:EE 
$strEE 
)EE 
;EE  
}FF 	
}GG 
}HH À
åC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_DataRepository\Migrations\20230515080409_Add Concurrency.cs
	namespace 	%
MagicVilla_DataRepository
 #
.# $

Migrations$ .
{ 
public		 

partial		 
class		 
AddConcurrency		 '
:		( )
	Migration		* 3
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
	AddColumn &
<& '
Guid' +
>+ ,
(, -
name 
: 
$str 
,  
table 
: 
$str 
,  
type 
: 
$str (
,( )
nullable 
: 
false 
,  
defaultValue 
: 
new !
Guid" &
(& '
$str' M
)M N
)N O
;O P
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 

DropColumn '
(' (
name 
: 
$str 
,  
table 
: 
$str 
)  
;  !
} 	
} 
} ±
àC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_DataRepository\Migrations\20230515115228_Concurrency.cs
	namespace 	%
MagicVilla_DataRepository
 #
.# $

Migrations$ .
{ 
public 

partial 
class 
Concurrency $
:% &
	Migration' 0
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
} 	
} 
} ∏
åC:\Users\s1124\OneDrive - sbnasoftware.com\Desktop\ASP.Net\MagicVilla\MagicVilla_DataRepository\Migrations\20230515121558_Concurrency New.cs
	namespace 	%
MagicVilla_DataRepository
 #
.# $

Migrations$ .
{ 
public 

partial 
class 
ConcurrencyNew '
:( )
	Migration* 3
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
} 	
} 
} 